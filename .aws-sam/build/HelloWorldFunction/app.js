"use strict";var Ce=Object.defineProperty;var nr=Object.getOwnPropertyDescriptor;var or=Object.getOwnPropertyNames;var ir=Object.prototype.hasOwnProperty;var ar=(e,t,r)=>t in e?Ce(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var cr=(e,t)=>{for(var r in t)Ce(e,r,{get:t[r],enumerable:!0})},lr=(e,t,r,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of or(t))!ir.call(e,n)&&n!==r&&Ce(e,n,{get:()=>t[n],enumerable:!(s=nr(t,n))||s.enumerable});return e};var hr=e=>lr(Ce({},"__esModule",{value:!0}),e);var p=(e,t,r)=>(ar(e,typeof t!="symbol"?t+"":t,r),r),Ge=(e,t,r)=>{if(!t.has(e))throw TypeError("Cannot "+r)};var i=(e,t,r)=>(Ge(e,t,"read from private field"),r?r.call(e):t.get(e)),f=(e,t,r)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,r)},u=(e,t,r,s)=>(Ge(e,t,"write to private field"),s?s.call(e,r):t.set(e,r),r),mt=(e,t,r,s)=>({set _(n){u(e,t,n,r)},get _(){return i(e,t,s)}}),m=(e,t,r)=>(Ge(e,t,"access private method"),r);var es={};cr(es,{default:()=>Zr,handler:()=>Xr});module.exports=hr(es);var We=(e,t,r)=>(s,n)=>{let o=-1;return a(0);async function a(l){if(l<=o)throw new Error("next() called multiple times");o=l;let c,h=!1,d;if(e[l]?(d=e[l][0][0],s.req.routeIndex=l):d=l===e.length&&n||void 0,d)try{c=await d(s,()=>a(l+1))}catch(g){if(g instanceof Error&&t)s.error=g,c=await t(g,s),h=!0;else throw g}else s.finalized===!1&&r&&(c=await r(s));return c&&(s.finalized===!1||h)&&(s.res=c),s}};var gt=async(e,t=Object.create(null))=>{let{all:r=!1,dot:s=!1}=t,o=(e instanceof $e?e.raw.headers:e.headers).get("Content-Type");return o?.startsWith("multipart/form-data")||o?.startsWith("application/x-www-form-urlencoded")?ur(e,{all:r,dot:s}):{}};async function ur(e,t){let r=await e.formData();return r?dr(r,t):{}}function dr(e,t){let r=Object.create(null);return e.forEach((s,n)=>{t.all||n.endsWith("[]")?fr(r,n,s):r[n]=s}),t.dot&&Object.entries(r).forEach(([s,n])=>{s.includes(".")&&(pr(r,s,n),delete r[s])}),r}var fr=(e,t,r)=>{e[t]!==void 0?Array.isArray(e[t])?e[t].push(r):e[t]=[e[t],r]:e[t]=r},pr=(e,t,r)=>{let s=e,n=t.split(".");n.forEach((o,a)=>{a===n.length-1?s[o]=r:((!s[o]||typeof s[o]!="object"||Array.isArray(s[o])||s[o]instanceof File)&&(s[o]=Object.create(null)),s=s[o])})};var Ye=e=>{let t=e.split("/");return t[0]===""&&t.shift(),t},yt=e=>{let{groups:t,path:r}=mr(e),s=Ye(r);return gr(s,t)},mr=e=>{let t=[];return e=e.replace(/\{[^}]+\}/g,(r,s)=>{let n=`@${s}`;return t.push([n,r]),n}),{groups:t,path:e}},gr=(e,t)=>{for(let r=t.length-1;r>=0;r--){let[s]=t[r];for(let n=e.length-1;n>=0;n--)if(e[n].includes(s)){e[n]=e[n].replace(s,t[r][1]);break}}return e},_e={},Xe=(e,t)=>{if(e==="*")return"*";let r=e.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);if(r){let s=`${e}#${t}`;return _e[s]||(r[2]?_e[s]=t&&t[0]!==":"&&t[0]!=="*"?[s,r[1],new RegExp(`^${r[2]}(?=/${t})`)]:[e,r[1],new RegExp(`^${r[2]}$`)]:_e[s]=[e,r[1],!0]),_e[s]}return null},Ze=(e,t)=>{try{return t(e)}catch{return e.replace(/(?:%[0-9A-Fa-f]{2})+/g,r=>{try{return t(r)}catch{return r}})}},yr=e=>Ze(e,decodeURI),et=e=>{let t=e.url,r=t.indexOf("/",8),s=r;for(;s<t.length;s++){let n=t.charCodeAt(s);if(n===37){let o=t.indexOf("?",s),a=t.slice(r,o===-1?void 0:o);return yr(a.includes("%25")?a.replace(/%25/g,"%2525"):a)}else if(n===63)break}return t.slice(r,s)};var wt=e=>{let t=et(e);return t.length>1&&t.at(-1)==="/"?t.slice(0,-1):t},Z=(e,t,...r)=>(r.length&&(t=Z(t,...r)),`${e?.[0]==="/"?"":"/"}${e}${t==="/"?"":`${e?.at(-1)==="/"?"":"/"}${t?.[0]==="/"?t.slice(1):t}`}`),He=e=>{if(e.charCodeAt(e.length-1)!==63||!e.includes(":"))return null;let t=e.split("/"),r=[],s="";return t.forEach(n=>{if(n!==""&&!/\:/.test(n))s+="/"+n;else if(/\:/.test(n))if(/\?/.test(n)){r.length===0&&s===""?r.push("/"):r.push(s);let o=n.replace("?","");s+="/"+o,r.push(s)}else s+="/"+n}),r.filter((n,o,a)=>a.indexOf(n)===o)},Ke=e=>/[%+]/.test(e)?(e.indexOf("+")!==-1&&(e=e.replace(/\+/g," ")),e.indexOf("%")!==-1?tt(e):e):e,bt=(e,t,r)=>{let s;if(!r&&t&&!/[%+]/.test(t)){let a=e.indexOf(`?${t}`,8);for(a===-1&&(a=e.indexOf(`&${t}`,8));a!==-1;){let l=e.charCodeAt(a+t.length+1);if(l===61){let c=a+t.length+2,h=e.indexOf("&",c);return Ke(e.slice(c,h===-1?void 0:h))}else if(l==38||isNaN(l))return"";a=e.indexOf(`&${t}`,a+1)}if(s=/[%+]/.test(e),!s)return}let n={};s??(s=/[%+]/.test(e));let o=e.indexOf("?",8);for(;o!==-1;){let a=e.indexOf("&",o+1),l=e.indexOf("=",o);l>a&&a!==-1&&(l=-1);let c=e.slice(o+1,l===-1?a===-1?void 0:a:l);if(s&&(c=Ke(c)),o=a,c==="")continue;let h;l===-1?h="":(h=e.slice(l+1,a===-1?void 0:a),s&&(h=Ke(h))),r?(n[c]&&Array.isArray(n[c])||(n[c]=[]),n[c].push(h)):n[c]??(n[c]=h)}return t?n[t]:n},Et=bt,xt=(e,t)=>bt(e,t,!0),tt=decodeURIComponent;var Rt=e=>Ze(e,tt),ae,k,Te,jt,ke,Pt,ye,rt,G,vt,$e=(vt=class{constructor(e,t="/",r=[[]]){f(this,Te);f(this,ke);f(this,ye);p(this,"raw");f(this,ae,void 0);f(this,k,void 0);p(this,"routeIndex",0);p(this,"path");p(this,"bodyCache",{});f(this,G,e=>{let{bodyCache:t,raw:r}=this,s=t[e];if(s)return s;let n=Object.keys(t)[0];return n?t[n].then(o=>(n==="json"&&(o=JSON.stringify(o)),new Response(o)[e]())):t[e]=r[e]()});this.raw=e,this.path=t,u(this,k,r),u(this,ae,{})}param(e){return e?m(this,Te,jt).call(this,e):m(this,ke,Pt).call(this)}query(e){return Et(this.url,e)}queries(e){return xt(this.url,e)}header(e){if(e)return this.raw.headers.get(e)??void 0;let t={};return this.raw.headers.forEach((r,s)=>{t[s]=r}),t}async parseBody(e){var t;return(t=this.bodyCache).parsedBody??(t.parsedBody=await gt(this,e))}json(){return i(this,G).call(this,"json")}text(){return i(this,G).call(this,"text")}arrayBuffer(){return i(this,G).call(this,"arrayBuffer")}blob(){return i(this,G).call(this,"blob")}formData(){return i(this,G).call(this,"formData")}addValidatedData(e,t){i(this,ae)[e]=t}valid(e){return i(this,ae)[e]}get url(){return this.raw.url}get method(){return this.raw.method}get matchedRoutes(){return i(this,k)[0].map(([[,e]])=>e)}get routePath(){return i(this,k)[0].map(([[,e]])=>e)[this.routeIndex].path}},ae=new WeakMap,k=new WeakMap,Te=new WeakSet,jt=function(e){let t=i(this,k)[0][this.routeIndex][1][e],r=m(this,ye,rt).call(this,t);return r?/\%/.test(r)?Rt(r):r:void 0},ke=new WeakSet,Pt=function(){let e={},t=Object.keys(i(this,k)[0][this.routeIndex][1]);for(let r of t){let s=m(this,ye,rt).call(this,i(this,k)[0][this.routeIndex][1][r]);s&&typeof s=="string"&&(e[r]=/\%/.test(s)?Rt(s):s)}return e},ye=new WeakSet,rt=function(e){return i(this,k)[1]?i(this,k)[1][e]:e},G=new WeakMap,vt);var St={Stringify:1,BeforeStream:2,Stream:3},wr=(e,t)=>{let r=new String(e);return r.isEscaped=!0,r.callbacks=t,r};var st=async(e,t,r,s,n)=>{typeof e=="object"&&!(e instanceof String)&&(e instanceof Promise||(e=e.toString()),e instanceof Promise&&(e=await e));let o=e.callbacks;if(!o?.length)return Promise.resolve(e);n?n[0]+=e:n=[e];let a=Promise.all(o.map(l=>l({phase:t,buffer:n,context:s}))).then(l=>Promise.all(l.filter(Boolean).map(c=>st(c,t,!1,s,n))).then(()=>n[0]));return r?wr(await a,o):a};var br="text/plain; charset=UTF-8",nt=(e,t={})=>{for(let r of Object.keys(t))e.set(r,t[r]);return e},we,be,I,ee,M,b,x,$,D,Ee,ce,le,xe,Re,C,_,Ot,At=(Ot=class{constructor(e,t){f(this,C);f(this,we,void 0);f(this,be,void 0);p(this,"env",{});f(this,I,void 0);p(this,"finalized",!1);p(this,"error");f(this,ee,200);f(this,M,void 0);f(this,b,void 0);f(this,x,void 0);f(this,$,void 0);f(this,D,!0);f(this,Ee,void 0);f(this,ce,void 0);f(this,le,void 0);f(this,xe,void 0);f(this,Re,void 0);p(this,"render",(...e)=>(i(this,ce)??u(this,ce,t=>this.html(t)),i(this,ce).call(this,...e)));p(this,"setLayout",e=>u(this,Ee,e));p(this,"getLayout",()=>i(this,Ee));p(this,"setRenderer",e=>{u(this,ce,e)});p(this,"header",(e,t,r)=>{if(this.finalized&&u(this,$,new Response(i(this,$).body,i(this,$))),t===void 0){i(this,b)?i(this,b).delete(e):i(this,x)&&delete i(this,x)[e.toLocaleLowerCase()],this.finalized&&this.res.headers.delete(e);return}r?.append?(i(this,b)||(u(this,D,!1),u(this,b,new Headers(i(this,x))),u(this,x,{})),i(this,b).append(e,t)):i(this,b)?i(this,b).set(e,t):(i(this,x)??u(this,x,{}),i(this,x)[e.toLowerCase()]=t),this.finalized&&(r?.append?this.res.headers.append(e,t):this.res.headers.set(e,t))});p(this,"status",e=>{u(this,D,!1),u(this,ee,e)});p(this,"set",(e,t)=>{i(this,I)??u(this,I,new Map),i(this,I).set(e,t)});p(this,"get",e=>i(this,I)?i(this,I).get(e):void 0);p(this,"newResponse",(...e)=>m(this,C,_).call(this,...e));p(this,"body",(e,t,r)=>typeof t=="number"?m(this,C,_).call(this,e,t,r):m(this,C,_).call(this,e,t));p(this,"text",(e,t,r)=>{if(!i(this,x)){if(i(this,D)&&!r&&!t)return new Response(e);u(this,x,{})}return i(this,x)["content-type"]=br,typeof t=="number"?m(this,C,_).call(this,e,t,r):m(this,C,_).call(this,e,t)});p(this,"json",(e,t,r)=>{let s=JSON.stringify(e);return i(this,x)??u(this,x,{}),i(this,x)["content-type"]="application/json",typeof t=="number"?m(this,C,_).call(this,s,t,r):m(this,C,_).call(this,s,t)});p(this,"html",(e,t,r)=>(i(this,x)??u(this,x,{}),i(this,x)["content-type"]="text/html; charset=UTF-8",typeof e=="object"?st(e,St.Stringify,!1,{}).then(s=>typeof t=="number"?m(this,C,_).call(this,s,t,r):m(this,C,_).call(this,s,t)):typeof t=="number"?m(this,C,_).call(this,e,t,r):m(this,C,_).call(this,e,t)));p(this,"redirect",(e,t)=>(i(this,b)??u(this,b,new Headers),i(this,b).set("Location",String(e)),this.newResponse(null,t??302)));p(this,"notFound",()=>(i(this,le)??u(this,le,()=>new Response),i(this,le).call(this,this)));u(this,we,e),t&&(u(this,M,t.executionCtx),this.env=t.env,u(this,le,t.notFoundHandler),u(this,Re,t.path),u(this,xe,t.matchResult))}get req(){return i(this,be)??u(this,be,new $e(i(this,we),i(this,Re),i(this,xe))),i(this,be)}get event(){if(i(this,M)&&"respondWith"in i(this,M))return i(this,M);throw Error("This context has no FetchEvent")}get executionCtx(){if(i(this,M))return i(this,M);throw Error("This context has no ExecutionContext")}get res(){return u(this,D,!1),i(this,$)||u(this,$,new Response("404 Not Found",{status:404}))}set res(e){if(u(this,D,!1),i(this,$)&&e){e=new Response(e.body,e);for(let[t,r]of i(this,$).headers.entries())if(t!=="content-type")if(t==="set-cookie"){let s=i(this,$).headers.getSetCookie();e.headers.delete("set-cookie");for(let n of s)e.headers.append("set-cookie",n)}else e.headers.set(t,r)}u(this,$,e),this.finalized=!0}get var(){return i(this,I)?Object.fromEntries(i(this,I)):{}}},we=new WeakMap,be=new WeakMap,I=new WeakMap,ee=new WeakMap,M=new WeakMap,b=new WeakMap,x=new WeakMap,$=new WeakMap,D=new WeakMap,Ee=new WeakMap,ce=new WeakMap,le=new WeakMap,xe=new WeakMap,Re=new WeakMap,C=new WeakSet,_=function(e,t,r){if(i(this,D)&&!r&&!t&&i(this,ee)===200)return new Response(e,{headers:i(this,x)});if(t&&typeof t!="number"){let n=new Headers(t.headers);i(this,b)&&i(this,b).forEach((a,l)=>{l==="set-cookie"?n.append(l,a):n.set(l,a)});let o=nt(n,i(this,x));return new Response(e,{headers:o,status:t.status??i(this,ee)})}let s=typeof t=="number"?t:i(this,ee);i(this,x)??u(this,x,{}),i(this,b)??u(this,b,new Headers),nt(i(this,b),i(this,x)),i(this,$)&&(i(this,$).headers.forEach((n,o)=>{o==="set-cookie"?i(this,b)?.append(o,n):i(this,b)?.set(o,n)}),nt(i(this,b),i(this,x))),r??(r={});for(let[n,o]of Object.entries(r))if(typeof o=="string")i(this,b).set(n,o);else{i(this,b).delete(n);for(let a of o)i(this,b).append(n,a)}return new Response(e,{status:s,headers:i(this,b)})},Ot);var E="ALL",Ct="all",$t=["get","post","put","delete","options","patch"],qe="Can not add a route since the matcher is already built.",Ne=class extends Error{};var _t="__COMPOSED_HANDLER";var Er=e=>e.text("404 Not Found",404),Ht=(e,t)=>"getResponse"in e?e.getResponse():(console.error(e),t.text("Internal Server Error",500)),q,Ie,kt,U,V,te,he,Le,ue,Be,Tt,ot=(Tt=class{constructor(e={}){f(this,Ie);f(this,V);f(this,he);f(this,ue);p(this,"get");p(this,"post");p(this,"put");p(this,"delete");p(this,"options");p(this,"patch");p(this,"all");p(this,"on");p(this,"use");p(this,"router");p(this,"getPath");p(this,"_basePath","/");f(this,q,"/");p(this,"routes",[]);f(this,U,Er);p(this,"errorHandler",Ht);p(this,"onError",e=>(this.errorHandler=e,this));p(this,"notFound",e=>(u(this,U,e),this));p(this,"fetch",(e,...t)=>m(this,ue,Be).call(this,e,t[1],t[0],e.method));p(this,"request",(e,t,r,s)=>e instanceof Request?this.fetch(t?new Request(e,t):e,r,s):(e=e.toString(),this.fetch(new Request(/^https?:\/\//.test(e)?e:`http://localhost${Z("/",e)}`,t),r,s)));p(this,"fire",()=>{addEventListener("fetch",e=>{e.respondWith(m(this,ue,Be).call(this,e.request,e,void 0,e.request.method))})});[...$t,Ct].forEach(n=>{this[n]=(o,...a)=>(typeof o=="string"?u(this,q,o):m(this,V,te).call(this,n,i(this,q),o),a.forEach(l=>{m(this,V,te).call(this,n,i(this,q),l)}),this)}),this.on=(n,o,...a)=>{for(let l of[o].flat()){u(this,q,l);for(let c of[n].flat())a.map(h=>{m(this,V,te).call(this,c.toUpperCase(),i(this,q),h)})}return this},this.use=(n,...o)=>(typeof n=="string"?u(this,q,n):(u(this,q,"*"),o.unshift(n)),o.forEach(a=>{m(this,V,te).call(this,E,i(this,q),a)}),this);let{strict:r,...s}=e;Object.assign(this,s),this.getPath=r??!0?e.getPath??et:wt}route(e,t){let r=this.basePath(e);return t.routes.map(s=>{var o;let n;t.errorHandler===Ht?n=s.handler:(n=async(a,l)=>(await We([],t.errorHandler)(a,()=>s.handler(a,l))).res,n[_t]=s.handler),m(o=r,V,te).call(o,s.method,s.path,n)}),this}basePath(e){let t=m(this,Ie,kt).call(this);return t._basePath=Z(this._basePath,e),t}mount(e,t,r){let s,n;r&&(typeof r=="function"?n=r:(n=r.optionHandler,r.replaceRequest===!1?s=l=>l:s=r.replaceRequest));let o=n?l=>{let c=n(l);return Array.isArray(c)?c:[c]}:l=>{let c;try{c=l.executionCtx}catch{}return[l.env,c]};s||(s=(()=>{let l=Z(this._basePath,e),c=l==="/"?0:l.length;return h=>{let d=new URL(h.url);return d.pathname=d.pathname.slice(c)||"/",new Request(d,h)}})());let a=async(l,c)=>{let h=await t(s(l.req.raw),...o(l));if(h)return h;await c()};return m(this,V,te).call(this,E,Z(e,"*"),a),this}},q=new WeakMap,Ie=new WeakSet,kt=function(){let e=new ot({router:this.router,getPath:this.getPath});return e.routes=this.routes,e},U=new WeakMap,V=new WeakSet,te=function(e,t,r){e=e.toUpperCase(),t=Z(this._basePath,t);let s={path:t,method:e,handler:r};this.router.add(e,t,[r,s]),this.routes.push(s)},he=new WeakSet,Le=function(e,t){if(e instanceof Error)return this.errorHandler(e,t);throw e},ue=new WeakSet,Be=function(e,t,r,s){if(s==="HEAD")return(async()=>new Response(null,await m(this,ue,Be).call(this,e,t,r,"GET")))();let n=this.getPath(e,{env:r}),o=this.router.match(s,n),a=new At(e,{path:n,matchResult:o,env:r,executionCtx:t,notFoundHandler:i(this,U)});if(o[0].length===1){let c;try{c=o[0][0][0][0](a,async()=>{a.res=await i(this,U).call(this,a)})}catch(h){return m(this,he,Le).call(this,h,a)}return c instanceof Promise?c.then(h=>h||(a.finalized?a.res:i(this,U).call(this,a))).catch(h=>m(this,he,Le).call(this,h,a)):c??i(this,U).call(this,a)}let l=We(o[0],this.errorHandler,i(this,U));return(async()=>{try{let c=await l(a);if(!c.finalized)throw new Error("Context is not finalized. Did you forget to return a Response object or `await next()`?");return c.res}catch(c){return m(this,he,Le).call(this,c,a)}})()},Tt);var Me="[^/]+",ve=".*",je="(?:|/.*)",de=Symbol(),xr=new Set(".\\+*[^]$()");function Rr(e,t){return e.length===1?t.length===1?e<t?-1:1:-1:t.length===1||e===ve||e===je?1:t===ve||t===je?-1:e===Me?1:t===Me?-1:e.length===t.length?e<t?-1:1:t.length-e.length}var re,se,N,qt,De=(qt=class{constructor(){f(this,re,void 0);f(this,se,void 0);f(this,N,Object.create(null))}insert(e,t,r,s,n){if(e.length===0){if(i(this,re)!==void 0)throw de;if(n)return;u(this,re,t);return}let[o,...a]=e,l=o==="*"?a.length===0?["","",ve]:["","",Me]:o==="/*"?["","",je]:o.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/),c;if(l){let h=l[1],d=l[2]||Me;if(h&&l[2]&&(d=d.replace(/^\((?!\?:)(?=[^)]+\)$)/,"(?:"),/\((?!\?:)/.test(d)))throw de;if(c=i(this,N)[d],!c){if(Object.keys(i(this,N)).some(g=>g!==ve&&g!==je))throw de;if(n)return;c=i(this,N)[d]=new De,h!==""&&u(c,se,s.varIndex++)}!n&&h!==""&&r.push([h,i(c,se)])}else if(c=i(this,N)[o],!c){if(Object.keys(i(this,N)).some(h=>h.length>1&&h!==ve&&h!==je))throw de;if(n)return;c=i(this,N)[o]=new De}c.insert(a,t,r,s,n)}buildRegExpStr(){let t=Object.keys(i(this,N)).sort(Rr).map(r=>{let s=i(this,N)[r];return(typeof i(s,se)=="number"?`(${r})@${i(s,se)}`:xr.has(r)?`\\${r}`:r)+s.buildRegExpStr()});return typeof i(this,re)=="number"&&t.unshift(`#${i(this,re)}`),t.length===0?"":t.length===1?t[0]:"(?:"+t.join("|")+")"}},re=new WeakMap,se=new WeakMap,N=new WeakMap,qt);var Ue,Pe,Nt,Lt=(Nt=class{constructor(){f(this,Ue,{varIndex:0});f(this,Pe,new De)}insert(e,t,r){let s=[],n=[];for(let a=0;;){let l=!1;if(e=e.replace(/\{[^}]+\}/g,c=>{let h=`@\\${a}`;return n[a]=[h,c],a++,l=!0,h}),!l)break}let o=e.match(/(?::[^\/]+)|(?:\/\*$)|./g)||[];for(let a=n.length-1;a>=0;a--){let[l]=n[a];for(let c=o.length-1;c>=0;c--)if(o[c].indexOf(l)!==-1){o[c]=o[c].replace(l,n[a][1]);break}}return i(this,Pe).insert(o,t,s,i(this,Ue),r),s}buildRegExp(){let e=i(this,Pe).buildRegExpStr();if(e==="")return[/^$/,[],[]];let t=0,r=[],s=[];return e=e.replace(/#(\d+)|@(\d+)|\.\*\$/g,(n,o,a)=>o!==void 0?(r[++t]=Number(o),"$()"):(a!==void 0&&(s[Number(a)]=++t),"")),[new RegExp(`^${e}`),r,s]}},Ue=new WeakMap,Pe=new WeakMap,Nt);var It=[],vr=[/^$/,[],Object.create(null)],Ve=Object.create(null);function Mt(e){return Ve[e]??(Ve[e]=new RegExp(e==="*"?"":`^${e.replace(/\/\*$|([.\\+*[^\]$()])/g,(t,r)=>r?`\\${r}`:"(?:|/.*)")}$`))}function jr(){Ve=Object.create(null)}function Pr(e){let t=new Lt,r=[];if(e.length===0)return vr;let s=e.map(h=>[!/\*|\/:/.test(h[0]),...h]).sort(([h,d],[g,y])=>h?1:g?-1:d.length-y.length),n=Object.create(null);for(let h=0,d=-1,g=s.length;h<g;h++){let[y,R,w]=s[h];y?n[R]=[w.map(([O])=>[O,Object.create(null)]),It]:d++;let j;try{j=t.insert(R,d,y)}catch(O){throw O===de?new Ne(R):O}y||(r[d]=w.map(([O,Q])=>{let J=Object.create(null);for(Q-=1;Q>=0;Q--){let[A,me]=j[Q];J[A]=me}return[O,J]}))}let[o,a,l]=t.buildRegExp();for(let h=0,d=r.length;h<d;h++)for(let g=0,y=r[h].length;g<y;g++){let R=r[h][g]?.[1];if(!R)continue;let w=Object.keys(R);for(let j=0,O=w.length;j<O;j++)R[w[j]]=l[R[w[j]]]}let c=[];for(let h in a)c[h]=r[a[h]];return[o,c,n]}function fe(e,t){if(!!e){for(let r of Object.keys(e).sort((s,n)=>n.length-s.length))if(Mt(r).test(t))return[...e[r]]}}var W,K,ze,Dt,Fe,Ut,Bt,it=(Bt=class{constructor(){f(this,ze);f(this,Fe);p(this,"name","RegExpRouter");f(this,W,void 0);f(this,K,void 0);u(this,W,{[E]:Object.create(null)}),u(this,K,{[E]:Object.create(null)})}add(e,t,r){var l;let s=i(this,W),n=i(this,K);if(!s||!n)throw new Error(qe);s[e]||[s,n].forEach(c=>{c[e]=Object.create(null),Object.keys(c[E]).forEach(h=>{c[e][h]=[...c[E][h]]})}),t==="/*"&&(t="*");let o=(t.match(/\/:/g)||[]).length;if(/\*$/.test(t)){let c=Mt(t);e===E?Object.keys(s).forEach(h=>{var d;(d=s[h])[t]||(d[t]=fe(s[h],t)||fe(s[E],t)||[])}):(l=s[e])[t]||(l[t]=fe(s[e],t)||fe(s[E],t)||[]),Object.keys(s).forEach(h=>{(e===E||e===h)&&Object.keys(s[h]).forEach(d=>{c.test(d)&&s[h][d].push([r,o])})}),Object.keys(n).forEach(h=>{(e===E||e===h)&&Object.keys(n[h]).forEach(d=>c.test(d)&&n[h][d].push([r,o]))});return}let a=He(t)||[t];for(let c=0,h=a.length;c<h;c++){let d=a[c];Object.keys(n).forEach(g=>{var y;(e===E||e===g)&&((y=n[g])[d]||(y[d]=[...fe(s[g],d)||fe(s[E],d)||[]]),n[g][d].push([r,o-h+c+1]))})}}match(e,t){jr();let r=m(this,ze,Dt).call(this);return this.match=(s,n)=>{let o=r[s]||r[E],a=o[2][n];if(a)return a;let l=n.match(o[0]);if(!l)return[[],It];let c=l.indexOf("",1);return[o[1][c],l]},this.match(e,t)}},W=new WeakMap,K=new WeakMap,ze=new WeakSet,Dt=function(){let e=Object.create(null);return Object.keys(i(this,K)).concat(Object.keys(i(this,W))).forEach(t=>{e[t]||(e[t]=m(this,Fe,Ut).call(this,t))}),u(this,W,u(this,K,void 0)),e},Fe=new WeakSet,Ut=function(e){let t=[],r=e===E;return[i(this,W),i(this,K)].forEach(s=>{let n=s[e]?Object.keys(s[e]).map(o=>[o,s[e][o]]):[];n.length!==0?(r||(r=!0),t.push(...n)):e!==E&&t.push(...Object.keys(s[E]).map(o=>[o,s[E][o]]))}),r?Pr(t):null},Bt);var Y,z,Vt,at=(Vt=class{constructor(e){p(this,"name","SmartRouter");f(this,Y,[]);f(this,z,[]);u(this,Y,e.routers)}add(e,t,r){if(!i(this,z))throw new Error(qe);i(this,z).push([e,t,r])}match(e,t){if(!i(this,z))throw new Error("Fatal error");let r=i(this,Y),s=i(this,z),n=r.length,o=0,a;for(;o<n;o++){let l=r[o];try{for(let c=0,h=s.length;c<h;c++)l.add(...s[c]);a=l.match(e,t)}catch(c){if(c instanceof Ne)continue;throw c}this.match=l.match.bind(l),u(this,Y,[l]),u(this,z,void 0);break}if(o===n)throw new Error("Fatal error");return this.name=`SmartRouter + ${this.activeRouter.name}`,a}get activeRouter(){if(i(this,z)||i(this,Y).length!==1)throw new Error("No active router has been determined yet.");return i(this,Y)[0]}},Y=new WeakMap,z=new WeakMap,Vt);var Se=Object.create(null),X,P,oe,pe,v,F,ne,zt,ct=(zt=class{constructor(e,t,r){f(this,F);f(this,X,void 0);f(this,P,void 0);f(this,oe,void 0);f(this,pe,0);f(this,v,Se);if(u(this,P,r||Object.create(null)),u(this,X,[]),e&&t){let s=Object.create(null);s[e]={handler:t,possibleKeys:[],score:0},u(this,X,[s])}u(this,oe,[])}insert(e,t,r){u(this,pe,++mt(this,pe)._);let s=this,n=yt(t),o=[];for(let c=0,h=n.length;c<h;c++){let d=n[c],g=n[c+1],y=Xe(d,g),R=Array.isArray(y)?y[0]:d;if(Object.keys(i(s,P)).includes(R)){s=i(s,P)[R];let w=Xe(d,g);w&&o.push(w[1]);continue}i(s,P)[R]=new ct,y&&(i(s,oe).push(y),o.push(y[1])),s=i(s,P)[R]}let a=Object.create(null),l={handler:r,possibleKeys:o.filter((c,h,d)=>d.indexOf(c)===h),score:i(this,pe)};return a[e]=l,i(s,X).push(a),s}search(e,t){let r=[];u(this,v,Se);let n=[this],o=Ye(t),a=[];for(let l=0,c=o.length;l<c;l++){let h=o[l],d=l===c-1,g=[];for(let y=0,R=n.length;y<R;y++){let w=n[y],j=i(w,P)[h];j&&(u(j,v,i(w,v)),d?(i(j,P)["*"]&&r.push(...m(this,F,ne).call(this,i(j,P)["*"],e,i(w,v))),r.push(...m(this,F,ne).call(this,j,e,i(w,v)))):g.push(j));for(let O=0,Q=i(w,oe).length;O<Q;O++){let J=i(w,oe)[O],A=i(w,v)===Se?{}:{...i(w,v)};if(J==="*"){let T=i(w,P)["*"];T&&(r.push(...m(this,F,ne).call(this,T,e,i(w,v))),u(T,v,A),g.push(T));continue}if(h==="")continue;let[me,Ae,B]=J,H=i(w,P)[me],Qe=o.slice(l).join("/");if(B instanceof RegExp){let T=B.exec(Qe);if(T){if(A[Ae]=T[0],r.push(...m(this,F,ne).call(this,H,e,i(w,v),A)),Object.keys(i(H,P)).length){u(H,v,A);let ge=T[0].match(/\//)?.length??0;(a[ge]||(a[ge]=[])).push(H)}continue}}(B===!0||B.test(h))&&(A[Ae]=h,d?(r.push(...m(this,F,ne).call(this,H,e,A,i(w,v))),i(H,P)["*"]&&r.push(...m(this,F,ne).call(this,i(H,P)["*"],e,A,i(w,v)))):(u(H,v,A),g.push(H)))}}n=g.concat(a.shift()??[])}return r.length>1&&r.sort((l,c)=>l.score-c.score),[r.map(({handler:l,params:c})=>[l,c])]}},X=new WeakMap,P=new WeakMap,oe=new WeakMap,pe=new WeakMap,v=new WeakMap,F=new WeakSet,ne=function(e,t,r,s){let n=[];for(let o=0,a=i(e,X).length;o<a;o++){let l=i(e,X)[o],c=l[t]||l[E],h={};if(c!==void 0&&(c.params=Object.create(null),n.push(c),r!==Se||s&&s!==Se))for(let d=0,g=c.possibleKeys.length;d<g;d++){let y=c.possibleKeys[d],R=h[c.score];c.params[y]=s?.[y]&&!R?s[y]:r[y]??s?.[y],h[c.score]=!0}}return n},zt);var ie,Ft,lt=(Ft=class{constructor(){p(this,"name","TrieRouter");f(this,ie,void 0);u(this,ie,new ct)}add(e,t,r){let s=He(t);if(s){for(let n=0,o=s.length;n<o;n++)i(this,ie).insert(e,s[n],r);return}i(this,ie).insert(e,t,r)}match(e,t){return i(this,ie).search(e,t)}},ie=new WeakMap,Ft);var ht=class extends ot{constructor(e={}){super(e),this.router=e.router??new at({routers:[new it,new lt]})}};var Qt=e=>{let t="",r=new Uint8Array(e);for(let s=0,n=r.length;s<n;s++)t+=String.fromCharCode(r[s]);return btoa(t)},Jt=e=>{let t=atob(e),r=new Uint8Array(new ArrayBuffer(t.length)),s=t.length/2;for(let n=0,o=t.length-1;n<=s;n++,o--)r[n]=t.charCodeAt(n),r[o]=t.charCodeAt(o);return r};var Sr=e=>e.requestContext;var ut=e=>async(t,r)=>{let s=Tr(t),n=s.createRequest(t),o=Sr(t),a=await e.fetch(n,{event:t,requestContext:o,lambdaContext:r});return s.createResult(t,a)},dt=class{createRequest(e){let t=this.getQueryString(e),r=e.requestContext&&"domainName"in e.requestContext?e.requestContext.domainName:e.headers?.host??e.multiValueHeaders?.host?.[0],s=this.getPath(e),n=`https://${r}${s}`,o=t?`${n}?${t}`:n,a=this.getHeaders(e),l=this.getMethod(e),c={headers:a,method:l};return e.body&&(c.body=e.isBase64Encoded?Jt(e.body):e.body),new Request(o,c)}async createResult(e,t){let r=t.headers.get("content-type"),s=!!(r&&Nr(r));if(!s){let a=t.headers.get("content-encoding");s=Lr(a)}let o={body:s?Qt(await t.arrayBuffer()):await t.text(),statusCode:t.status,isBase64Encoded:s,...e.multiValueHeaders?{multiValueHeaders:{}}:{headers:{}}};return this.setCookies(e,t,o),o.multiValueHeaders?t.headers.forEach((a,l)=>{o.multiValueHeaders[l]=[a]}):t.headers.forEach((a,l)=>{o.headers[l]=a}),o}setCookies(e,t,r){if(t.headers.has("set-cookie")){let s=t.headers.getSetCookie?t.headers.getSetCookie():Array.from(t.headers.entries()).filter(([n])=>n==="set-cookie").map(([,n])=>n);Array.isArray(s)&&(this.setCookiesToResult(r,s),t.headers.delete("set-cookie"))}}},Or=class extends dt{getPath(e){return e.rawPath}getMethod(e){return e.requestContext.http.method}getQueryString(e){return e.rawQueryString}getCookies(e,t){Array.isArray(e.cookies)&&t.set("Cookie",e.cookies.join("; "))}setCookiesToResult(e,t){e.cookies=t}getHeaders(e){let t=new Headers;if(this.getCookies(e,t),e.headers)for(let[r,s]of Object.entries(e.headers))s&&t.set(r,s);return t}},Ar=new Or,Cr=class extends dt{getPath(e){return e.path}getMethod(e){return e.httpMethod}getQueryString(e){return e.multiValueQueryStringParameters?Object.entries(e.multiValueQueryStringParameters||{}).filter(([,t])=>t).map(([t,r])=>`${t}=${r.join(`&${t}=`)}`).join("&"):Object.entries(e.queryStringParameters||{}).filter(([,t])=>t).map(([t,r])=>`${t}=${r}`).join("&")}getCookies(e,t){}getHeaders(e){let t=new Headers;if(this.getCookies(e,t),e.headers)for(let[r,s]of Object.entries(e.headers))s&&t.set(r,s);if(e.multiValueHeaders){for(let[r,s]of Object.entries(e.multiValueHeaders))if(s){let n=t.get(r);s.forEach(o=>(!n||!n.includes(o))&&t.append(r,o))}}return t}setCookiesToResult(e,t){e.multiValueHeaders={"set-cookie":t}}},$r=new Cr,_r=class extends dt{getHeaders(e){let t=new Headers;if(e.multiValueHeaders)for(let[r,s]of Object.entries(e.multiValueHeaders))s&&Array.isArray(s)&&t.set(r,s.join("; "));else for(let[r,s]of Object.entries(e.headers??{}))s&&t.set(r,s);return t}getPath(e){return e.path}getMethod(e){return e.httpMethod}getQueryString(e){return e.multiValueQueryStringParameters?Object.entries(e.multiValueQueryStringParameters||{}).filter(([,t])=>t).map(([t,r])=>`${t}=${r.join(`&${t}=`)}`).join("&"):Object.entries(e.queryStringParameters||{}).filter(([,t])=>t).map(([t,r])=>`${t}=${r}`).join("&")}getCookies(e,t){let r;e.multiValueHeaders?r=e.multiValueHeaders.cookie?.join("; "):r=e.headers?e.headers.cookie:void 0,r&&t.append("Cookie",r)}setCookiesToResult(e,t){e.multiValueHeaders?e.multiValueHeaders["set-cookie"]=t:e.headers["set-cookie"]=t.join(", ")}},Hr=new _r,Tr=e=>kr(e)?Hr:qr(e)?Ar:$r,kr=e=>e.requestContext?Object.hasOwn(e.requestContext,"elb"):!1,qr=e=>Object.hasOwn(e,"rawPath"),Nr=e=>!/^(text\/(plain|html|css|javascript|csv).*|application\/(.*json|.*xml).*|image\/svg\+xml.*)$/.test(e),Lr=e=>e===null?!1:/^(gzip|deflate|compress|br)/.test(e);var Gt=e=>{let r={...{origin:"*",allowMethods:["GET","HEAD","PUT","POST","DELETE","PATCH"],allowHeaders:[],exposeHeaders:[]},...e},s=(n=>typeof n=="string"?n==="*"?()=>n:o=>n===o?o:null:typeof n=="function"?n:o=>n.includes(o)?o:null)(r.origin);return async function(o,a){function l(h,d){o.res.headers.set(h,d)}let c=s(o.req.header("origin")||"",o);if(c&&l("Access-Control-Allow-Origin",c),r.origin!=="*"){let h=o.req.header("Vary");h?l("Vary",h):l("Vary","Origin")}if(r.credentials&&l("Access-Control-Allow-Credentials","true"),r.exposeHeaders?.length&&l("Access-Control-Expose-Headers",r.exposeHeaders.join(",")),o.req.method==="OPTIONS"){r.maxAge!=null&&l("Access-Control-Max-Age",r.maxAge.toString()),r.allowMethods?.length&&l("Access-Control-Allow-Methods",r.allowMethods.join(","));let h=r.allowHeaders;if(!h?.length){let d=o.req.header("Access-Control-Request-Headers");d&&(h=d.split(/\s*,\s*/))}return h?.length&&(l("Access-Control-Allow-Headers",h.join(",")),o.res.headers.append("Vary","Access-Control-Request-Headers")),o.res.headers.delete("Content-Length"),o.res.headers.delete("Content-Type"),new Response(null,{headers:o.res.headers,status:204,statusText:"No Content"})}await a()}};function Wt(){let{process:e,Deno:t}=globalThis;return!(typeof t?.noColor=="boolean"?t.noColor:e!==void 0?"NO_COLOR"in e?.env:!1)}var Br=e=>{let[t,r]=[",","."];return e.map(n=>n.replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1"+t)).join(r)},Ir=e=>{let t=Date.now()-e;return Br([t<1e3?t+"ms":Math.round(t/1e3)+"s"])},Mr=e=>{if(Wt())switch(e/100|0){case 5:return`\x1B[31m${e}\x1B[0m`;case 4:return`\x1B[33m${e}\x1B[0m`;case 3:return`\x1B[36m${e}\x1B[0m`;case 2:return`\x1B[32m${e}\x1B[0m`}return`${e}`};function Kt(e,t,r,s,n=0,o){let a=t==="<--"?`${t} ${r} ${s}`:`${t} ${r} ${s} ${Mr(n)} ${o}`;e(a)}var Yt=(e=console.log)=>async function(r,s){let{method:n,url:o}=r.req,a=o.slice(o.indexOf("/",8));Kt(e,"<--",n,a);let l=Date.now();await s(),Kt(e,"-->",n,a,r.res.status,Ir(l))};var Dr="gnti7y5zkih9elje0lzd4b84g",Ur="7ca33bfaf9ce41fbbc43a2abeec4e53d",Vr="79b0572f34084761b508cbca34bd3512",zr="AQDbn04HT4tNMovNt2r3j_xiNOz2qJPXrsIszfJEH7MfEQCR2ZBGsk9vrBeYosvqfy92UM2ciFLONzwd3K8J63wklBh9NBGfIypgOg-wgRpjGiYuPYD6gc933gNR_TpnhNU",Xt=Dr,Fr=Ur,Qr=Vr,L="",Jr=Buffer.from(`${Fr}:${Qr}`).toString("base64"),Gr={Authorization:`Basic ${Jr}`,"Content-Type":"application/x-www-form-urlencoded"},Wr=new URLSearchParams({grant_type:"refresh_token",refresh_token:zr});async function Oe(){return L=(await(await fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:Gr,body:Wr})).json()).access_token}async function ft(e){try{await Oe(),console.log(e);let t;e.setlist_name?t=e.setlist_name:e.event_date?t=`${e.artist_name} - ${e.event_date.toISOString().split("T")[0]}`:t=`${e.artist_name} - ${new Date().toISOString().split("T")[0]}`;let s=await(await fetch(`https://api.spotify.com/v1/users/${Xt}/playlists`,{method:"POST",headers:{Authorization:`Bearer ${L}`,"Content-Type":"application/json"},body:JSON.stringify({name:`${t}`,public:!0})})).json(),n=e.songs.map(a=>Kr(a.name,a.original_artist)),o=await Promise.all(n);return await Yr(s.id,o),console.log(`Playlist created: https://open.spotify.com/playlist/${s.id}`),s.id}catch(t){console.error("Error submitting setlist:",t)}}async function Kr(e,t){e.startsWith("#")&&(e=e.slice(1));let r=encodeURIComponent(`${e} ${t}`),s=decodeURIComponent(r);return console.log(`Searching for: ${s}`),(await(await fetch(`https://api.spotify.com/v1/search?q=${s}&type=track&limit=10&market=JP`,{headers:{Authorization:`Bearer ${L}`}})).json()).tracks.items[0].id}async function Yr(e,t){await fetch(`https://api.spotify.com/v1/playlists/${e}/tracks`,{method:"POST",headers:{Authorization:`Bearer ${L}`,"Content-Type":"application/json"},body:JSON.stringify({uris:t.map(r=>`spotify:track:${r}`)})})}async function Zt(e){return await Oe(),await(await fetch(`https://api.spotify.com/v1/playlists/${e}`,{method:"GET",headers:{Authorization:`Bearer ${L}`,"Content-Type":"application/json"}})).json()}async function er(e,t){await Oe();let r=encodeURIComponent(`${e} ${t}`),s=decodeURIComponent(r);return console.log(`Searching for: ${s}`),await(await fetch(`https://api.spotify.com/v1/search?q=${s}&type=track&limit=10&market=JP`,{headers:{Authorization:`Bearer ${L}`}})).json()}async function tr(e,t){await Oe();let n=(await(await fetch(`https://api.spotify.com/v1/playlists/${e}`,{headers:{Authorization:`Bearer ${L}`}})).json()).name,a=await(await fetch(`https://api.spotify.com/v1/users/${Xt}/playlists`,{method:"POST",headers:{Authorization:`Bearer ${L}`,"Content-Type":"application/json"},body:JSON.stringify({name:n,public:!0})})).json();for(let l of t)await fetch(`https://api.spotify.com/v1/playlists/${a.id}/tracks`,{method:"POST",headers:{Authorization:`Bearer ${L}`,"Content-Type":"application/json"},body:JSON.stringify({uris:[`spotify:track:${l}`]})});return console.log(a.id),a.id}async function rr(e,t){await Oe();let r=encodeURIComponent(`${e}`),s=decodeURIComponent(r);console.log(`Searching for: ${s}`);let n={Authorization:`Bearer ${L}`};return t==="livefans"&&(n["Accept-Language"]="ja"),await(await fetch(`https://api.spotify.com/v1/search?q=${s}&type=artist&limit=10&market=JP`,{headers:n})).json()}var S=new ht;S.use("*",Gt());S.use("*",Yt());S.get("/",e=>e.text("hello"));S.get("/api",e=>e.text("hello!!"));S.get("/api/livefans/fetch_html",async e=>{try{let t=e.req.query("artist")||"",s=`https://www.livefans.jp/search?option=1&keyword=${encodeURIComponent(t).replace(/%20/g,"+")}&genre=all`,n={handler_type:"sub",url:s},a=await fetch("https://pur2p81urh.execute-api.ap-northeast-1.amazonaws.com/default/selenium-lambda",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!a.ok)throw new Error(`Lambda API responded with status: ${a.status}`);let l=await a.json();return console.log(l),e.json(l)}catch(t){return console.error("Error fetching HTML:",t),e.text("Error fetching HTML",500)}});S.get("/api/livefans/detail/:id",async e=>{let r=`https://www.livefans.jp/events/${e.req.param("id")}`;try{let s="https://pur2p81urh.execute-api.ap-northeast-1.amazonaws.com/default/selenium-lambda",n={handler_type:"main",url:r},a=await(await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})).json();console.log(a);let l={artist_name:a?.artist_name,location:a?.location,venue:a?.venue,tour_name:a?.tour_name,songs:a?.songs};return e.json(l)}catch(s){return console.error("Error fetching HTML:",s),e.text("Error fetching HTML",500)}});S.get("/api/livefans/:id",async e=>{let t=e.req.param("id"),r=e.req.query("isCover")==="true",s=`https://www.livefans.jp/events/${t}`;if(!s)return e.json({error:"URL parameter is required"},400);try{let n="https://pur2p81urh.execute-api.ap-northeast-1.amazonaws.com/default/selenium-lambda",o={handler_type:"main",url:s,iscover:r},a=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!a.ok)throw new Error(`Lambda API responded with status: ${a.status}`);let l=await a.json(),c={artist_name:l?.artist_name,location:l?.location,venue:l?.venue,tour_name:l?.tour_name,songs:l?.songs};console.log(c.songs);let h=await ft(c);return c.setlist_id=h,e.json(c)}catch(n){return console.error("Error invoking Lambda:",n),e.json({error:"Failed to invoke Lambda function"},500)}});S.get("/api/setlistfm/fetch_html",async e=>{try{let t=e.req.query("artist")||"",r=encodeURIComponent(t).replace(/%20/g,"+"),s={"x-api-key":"rvH9s-nOQE4FOGgLByWj1VfmjzqIaEt5Q8wB",Accept:"application/json"},n=`https://api.setlist.fm/rest/1.0/search/artists?artistName=${r}&sort=relevance`,l=(await(await fetch(n,{headers:s})).json()).artist[0].mbid,h=await(await fetch(`https://api.setlist.fm/rest/1.0/artist/${l}/setlists`,{headers:s})).json();return console.log(h),e.json(h)}catch(t){return console.error("Error fetching HTML:",t),e.text("Error fetching HTML",500)}});S.get("/api/setlistfm/:id",async e=>{let t=e.req.param("id"),r,s=e.req.header("Content-Type");s&&s.includes("application/json")?r=(await e.req.json()).setlist_name:r=(await e.req.parseBody()).setlist_name;let n=e.req.query("isCover")==="true",o=e.req.query("isTape")==="true",a=`https://api.setlist.fm/rest/1.0/setlist/${t}`,l={"x-api-key":"rvH9s-nOQE4FOGgLByWj1VfmjzqIaEt5Q8wB",Accept:"application/json"};try{console.log(`Fetching setlist with ID: ${t}`);let c=await fetch(a,{headers:l});if(!c.ok)throw console.error(`HTTP error! status: ${c.status}`),new Error(`HTTP error! status: ${c.status}`);let h=await c.json();console.log("Fetched data:",h);let d=h.artist.name,g=new Date(h.eventDate.split("-").reverse().join("-")),y=h.venue,R=y.city,w=R.country.name,j=`${R.name}, ${w}`,O=y.name,Q=h.tour?.name||"",J=[];h.sets.set.forEach(Ae=>{Ae.song.forEach(B=>{let H=B.name,Qe=B.tape||!1,T="cover"in B,ge=H.split(" / ");for(let pt of ge){let sr=T?B.cover.name:d,Je={name:pt,original_artist:sr,is_tape:Qe,is_cover:T};Je.is_tape||(!n||!Je.is_cover)&&J.push(Je)}})});let A={artist_name:d,event_date:g,location:j,venue:O,tour_name:Q,songs:J,setlist_id:t},me=await ft(A);return A.setlist_id=me,e.json(A)}catch(c){return console.error("Error fetching setlist:",c),e.json({error:"Failed to fetch setlist"},500)}});S.get("/api/modify/:id",async e=>{let t=e.req.param("id"),r=await Zt(t);return e.json(r)});S.get("/api/song/search/:artist/:name",async e=>{let t=e.req.param("name")||"",r=e.req.param("artist")||"",s=await er(t,r);return e.json(s)});S.get("/api/artist/search",async e=>{let t=e.req.query("q")||"",r=e.req.query("site")||"";console.log(r);let s=await rr(t,r);return e.json(s)});S.post("/api/recreate/playlist/:id",async e=>{let t=e.req.param("id"),r=JSON.parse(await e.req.text());console.log(r);let s=await tr(t,r);return e.json(s)});var Xr=ut(S),Zr=S;0&&(module.exports={handler});
//# sourceMappingURL=app.js.map
